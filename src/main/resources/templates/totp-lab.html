<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>TOTP Lab</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div th:replace="fragments/navbar :: navbar"></div>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h3 class="card-title mb-3">TOTP Lab (RFC 6238)</h3>

                    <form th:action="@{/lab/totp}" method="post" class="row g-3">
                        <div class="col-12">
                            <label class="form-label">Secret (Base32)</label>
                            <input type="text" name="secret" class="form-control" required th:value="${secret}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Time step (seconds)</label>
                            <input type="number" name="timeStep" class="form-control" min="10" th:value="${timeStep}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Digits</label>
                            <input type="number" name="digits" class="form-control" min="4" max="8" th:value="${digits}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Window (± steps)</label>
                            <input type="number" name="window" class="form-control" min="0" th:value="${window}">
                        </div>
                        <div class="col-12 d-grid">
                            <button class="btn btn-primary" type="submit">Generate</button>
                        </div>
                    </form>

                    <hr>

                    <div th:if="${current}">
                        <h6>Kết quả hiện tại</h6>
                        <p class="mb-1">Unix time: <code th:text="${unixTime}"></code></p>
                        <p class="mb-1">Time counter T: <code th:text="${current.counter}"></code></p>
                        <p class="mb-1">OTP: <strong th:text="${current.otp}"></strong></p>
                        <p class="small text-muted mb-0">Mỗi mã hiệu lực <span th:text="${timeStep}"></span> giây, cửa sổ ±<span th:text="${window}"></span>.</p>
                    </div>

                    <div th:if="${windowList}">
                        <h6 class="mt-3">Debug (các counter trong cửa sổ)</h6>
                        <div class="table-responsive">
                            <table class="table table-sm align-middle">
                                <thead>
                                <tr>
                                    <th>Counter</th>
                                    <th>OTP</th>
                                    <th>HMAC (hex)</th>
                                    <th>Offset</th>
                                    <th>Binary code</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="item : ${windowList}">
                                    <td><code th:text="${item.counter}"></code></td>
                                    <td><strong th:text="${item.otp}"></strong></td>
                                    <td class="small"><code th:text="${item.hmacHex}"></code></td>
                                    <td><code th:text="${item.offset}"></code></td>
                                    <td><code th:text="${item.binaryCode}"></code></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <hr>
                    <a th:href="@{/}" class="btn btn-link ps-0">Về trang chủ</a>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>

